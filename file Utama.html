<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Pro - Modern Stock Management</title>
    <style>
        :root {
            /* Modern Color Palette */
            --primary-50: #eef4ff;
            --primary-100: #dae6ff;
            --primary-200: #bdd4ff;
            --primary-300: #90baff;
            --primary-400: #5c95ff;
            --primary-500: #366eff;
            --primary-600: #1d4ed8;
            --primary-700: #1e40af;
            --primary-800: #1e3a8a;
            --primary-900: #1e3a8a;
            
            /* Success Colors */
            --success-50: #ecfdf5;
            --success-100: #d1fae5;
            --success-200: #a7f3d0;
            --success-300: #6ee7b7;
            --success-400: #34d399;
            --success-500: #10b981;
            --success-600: #059669;
            --success-700: #047857;
            --success-800: #065f46;
            --success-900: #064e3b;
            
            /* Warning Colors */
            --warning-50: #fffbeb;
            --warning-100: #fef3c7;
            --warning-200: #fde68a;
            --warning-300: #fcd34d;
            --warning-400: #fbbf24;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --warning-700: #b45309;
            --warning-800: #92400e;
            --warning-900: #78350f;
            
            /* Danger Colors */
            --danger-50: #fef2f2;
            --danger-100: #fee2e2;
            --danger-200: #fecaca;
            --danger-300: #fca5a5;
            --danger-400: #f87171;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --danger-700: #b91c1c;
            --danger-800: #991b1b;
            --danger-900: #7f1d1d;
            
            /* Light Mode */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --bg-accent: #e2e8f0;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --border-color: rgba(226, 232, 240, 0.6);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 40px rgba(54, 110, 255, 0.15);
            
            /* Layout */
            --sidebar-width: 280px;
            --header-height: 80px;
            --bottom-nav-height: 85px;
            --border-radius: 16px;
            --border-radius-lg: 20px;
            --border-radius-xl: 24px;

            /* Modern Stock View Variables */
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --glass-backdrop: blur(16px) saturate(180%);
            
            --glow-primary: 0 0 40px rgba(54, 110, 255, 0.3);
            --glow-success: 0 0 40px rgba(16, 185, 129, 0.3);
            --glow-warning: 0 0 40px rgba(245, 158, 11, 0.3);
            --glow-danger: 0 0 40px rgba(239, 68, 68, 0.3);
            
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-danger: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            
            --transition-smooth: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --transition-elastic: all 0.8s cubic-bezier(0.68, -0.6, 0.32, 1.6);
        }

        [data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-accent: #262626;
            --bg-glass: rgba(10, 10, 10, 0.85);
            --text-primary: #ffffff;
            --text-secondary: #a3a3a3;
            --text-tertiary: #737373;
            --border-color: rgba(38, 38, 38, 0.6);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 40px rgba(54, 110, 255, 0.25);

            /* Modern Stock View Dark Variables */
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            letter-spacing: -0.01em;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-right: 1px solid var(--border-color);
            transform: translateX(-100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            backdrop-filter: blur(10px);
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .sidebar-menu {
            padding: 24px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-left: 3px solid transparent;
            margin: 4px 12px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(54, 110, 255, 0.1), transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .menu-item:hover::before {
            left: 100%;
        }

        .menu-item:hover,
        .menu-item.active {
            background: linear-gradient(90deg, var(--primary-50), var(--primary-100));
            color: var(--primary-700);
            border-left-color: var(--primary-500);
            transform: translateX(6px);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .menu-item:hover,
        [data-theme="dark"] .menu-item.active {
            background: linear-gradient(90deg, var(--primary-900), var(--primary-800));
            color: var(--primary-300);
        }

        .menu-item .icon {
            margin-right: 16px;
            font-size: 1.25rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }

        .menu-item:hover .icon {
            transform: scale(1.1);
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            transition: margin-left 0.3s ease;
        }

        .main-layout.sidebar-open .main-content {
            margin-left: var(--sidebar-width);
        }

        /* Header */
        .header {
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-bottom: 1px solid var(--border-color);
            padding: 0 32px;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            padding: 12px;
            border-radius: var(--border-radius);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .menu-toggle:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .header-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .theme-toggle {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            font-size: 1.25rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 12px;
            border-radius: var(--border-radius);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .firebase-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            background: var(--danger-100);
            color: var(--danger-700);
            border: 1px solid var(--danger-200);
        }

        .firebase-status.connected {
            background: var(--success-100);
            color: var(--success-700);
            border-color: var(--success-200);
        }

        /* Content */
        .content {
            padding: 24px;
            margin-bottom: calc(var(--bottom-nav-height) + 20px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modern Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--stat-color);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(135deg, var(--stat-color), transparent);
            opacity: 0.05;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::after {
            opacity: 0.1;
        }

        .stat-card.primary { --stat-color: var(--primary-500); }
        .stat-card.success { --stat-color: var(--success-500); }
        .stat-card.warning { --stat-color: var(--warning-500); }
        .stat-card.danger { --stat-color: var(--danger-500); }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            border-color: var(--stat-color);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.8;
            color: var(--stat-color);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Modern Cards */
        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-radius: var(--border-radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .card:hover {
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            transform: translateY(-4px);
            border-color: var(--primary-200);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.02em;
        }

        /* Enhanced Tables */
        .table-container {
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-radius: var(--border-radius-xl);
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
        }

        .table-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-secondary);
            padding: 20px 24px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            letter-spacing: -0.01em;
        }

        .table td {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .table tr:hover {
            background: var(--bg-secondary);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        /* Stock Status Badges */
        .stock-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .stock-high {
            background: var(--success-100);
            color: var(--success-700);
            border: 1px solid var(--success-200);
        }

        .stock-medium {
            background: var(--warning-100);
            color: var(--warning-700);
            border: 1px solid var(--warning-200);
        }

        .stock-low {
            background: var(--danger-100);
            color: var(--danger-700);
            border: 1px solid var(--danger-200);
        }

        [data-theme="dark"] .stock-high {
            background: var(--success-900);
            color: var(--success-300);
            border-color: var(--success-700);
        }

        [data-theme="dark"] .stock-medium {
            background: var(--warning-900);
            color: var(--warning-300);
            border-color: var(--warning-700);
        }

        [data-theme="dark"] .stock-low {
            background: var(--danger-900);
            color: var(--danger-300);
            border-color: var(--danger-700);
        }

        /* Modern Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.9rem;
            letter-spacing: -0.01em;
        }

        .form-input,
        .form-select {
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px rgba(54, 110, 255, 0.1), var(--shadow-lg);
            transform: translateY(-2px);
        }

        /* Modern Buttons */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            letter-spacing: -0.01em;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--success-600), var(--success-700));
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600));
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, var(--danger-600), var(--danger-700));
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-accent);
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        /* Bottom Navigation (Mobile) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-nav-height);
            background: var(--bg-glass);
            backdrop-filter: blur(24px) saturate(180%);
            border-top: 1px solid var(--border-color);
            display: none;
            z-index: 100;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.12);
            padding: 8px 0;
        }

        .bottom-nav-items {
            display: flex;
            height: 100%;
        }

        .bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            gap: 6px;
            border-radius: var(--border-radius);
            margin: 4px;
            position: relative;
            overflow: hidden;
        }

        .bottom-nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: var(--border-radius);
        }

        .bottom-nav-item.active::before {
            opacity: 1;
        }

        .bottom-nav-item.active {
            color: var(--primary-600);
            transform: translateY(-2px);
        }

        [data-theme="dark"] .bottom-nav-item::before {
            background: linear-gradient(135deg, var(--primary-900), var(--primary-800));
        }

        [data-theme="dark"] .bottom-nav-item.active {
            color: var(--primary-400);
        }

        .bottom-nav-item .nav-icon {
            font-size: 1.75rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }

        .bottom-nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .bottom-nav-item .nav-label {
            font-size: 0.75rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
            letter-spacing: -0.01em;
        }

        /* Loading and Empty States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .empty-text {
            font-size: 1rem;
            font-weight: 500;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 3000;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
        }

        .notification.success { background: var(--success-500); }
        .notification.error { background: var(--danger-500); }
        .notification.info { background: var(--primary-500); }
        .notification.warning { background: var(--warning-500); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Ultra Modern Stock View Styles */
        /* Hero Section */
        .stock-hero {
            margin-bottom: 48px;
            position: relative;
        }

        .hero-content {
            text-align: center;
            margin-bottom: 40px;
        }

        .hero-badge {
            display: inline-block;
            padding: 8px 20px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-600);
            margin-bottom: 16px;
            box-shadow: var(--glass-shadow);
            transition: var(--transition-smooth);
        }

        .hero-badge:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-primary);
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary), var(--primary-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 16px 0;
            letter-spacing: -0.04em;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 400;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .analytics-card {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            transition: var(--transition-smooth);
            overflow: hidden;
            cursor: pointer;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-gradient);
            transition: height 0.4s ease;
        }

        .analytics-card.primary {
            --card-gradient: var(--gradient-primary);
        }

        .analytics-card.success {
            --card-gradient: var(--gradient-success);
        }

        .analytics-card.warning {
            --card-gradient: var(--gradient-warning);
        }

        .analytics-card.danger {
            --card-gradient: var(--gradient-danger);
        }

        .analytics-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--glass-shadow), var(--card-glow);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .analytics-card:hover::before {
            height: 8px;
        }

        .analytics-card.primary:hover {
            --card-glow: var(--glow-primary);
        }

        .analytics-card.success:hover {
            --card-glow: var(--glow-success);
        }

        .analytics-card.warning:hover {
            --card-glow: var(--glow-warning);
        }

        .analytics-card.danger:hover {
            --card-glow: var(--glow-danger);
        }

        .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--card-gradient);
            opacity: 0;
            transition: opacity 0.4s ease;
            border-radius: 24px;
            filter: blur(20px);
            z-index: -1;
        }

        .analytics-card:hover .card-glow {
            opacity: 0.2;
        }

        .card-content {
            position: relative;
            z-index: 2;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-trend {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 700;
            transition: var(--transition-bounce);
        }

        .metric-trend.positive {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            color: white;
        }

        .metric-trend.neutral {
            background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
            color: white;
        }

        .metric-trend.negative {
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600));
            color: white;
        }

        .analytics-card:hover .metric-trend {
            transform: scale(1.2) rotate(360deg);
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.03em;
            line-height: 1;
        }

        .metric-change {
            font-size: 0.875rem;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        /* Control Interface */
        .control-interface {
            margin-bottom: 32px;
        }

        .interface-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--glass-shadow);
            display: grid;
            grid-template-columns: 2fr 3fr 1fr;
            gap: 32px;
            align-items: center;
        }

        /* Modern Search */
        .search-container {
            position: relative;
        }

        .search-input-group {
            position: relative;
            overflow: hidden;
        }

        .search-field {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition-smooth);
            outline: none;
        }

        .search-field::placeholder {
            color: var(--text-tertiary);
        }

        .search-field:focus {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
            box-shadow: 0 0 0 4px rgba(54, 110, 255, 0.2);
        }

        .search-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            width: 0;
            background: var(--gradient-primary);
            transition: width 0.4s ease;
        }

        .search-field:focus ~ .search-line {
            width: 100%;
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            background: var(--danger-500);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-bounce);
            font-size: 16px;
            font-weight: 600;
        }

        .search-clear:hover {
            transform: translateY(-50%) scale(1.2);
            background: var(--danger-600);
        }

        /* Filter Pills */
        .filter-pills {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .filter-pill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--pill-gradient);
            transition: left 0.6s ease;
            z-index: 1;
        }

        .filter-pill:hover::before,
        .filter-pill.active::before {
            left: 0;
        }

        .filter-pill.success {
            --pill-gradient: var(--gradient-success);
        }

        .filter-pill.warning {
            --pill-gradient: var(--gradient-warning);
        }

        .filter-pill.danger {
            --pill-gradient: var(--gradient-danger);
        }

        .filter-pill:not(.active) {
            --pill-gradient: var(--gradient-primary);
        }

        .filter-pill:hover,
        .filter-pill.active {
            color: white;
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--glass-shadow);
        }

        .pill-text,
        .pill-badge {
            position: relative;
            z-index: 2;
        }

        .pill-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .action-button {
            position: relative;
            padding: 12px 24px;
            border: none;
            border-radius: 16px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            overflow: hidden;
            min-width: 100px;
        }

        .action-button.primary {
            background: var(--gradient-primary);
            color: white;
        }

        .action-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .action-button.tertiary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .action-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--glass-shadow);
        }

        .btn-ripple {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .action-button:active .btn-ripple {
            opacity: 1;
        }

        .btn-text {
            position: relative;
            z-index: 2;
        }

        /* Data Section */
        .data-section {
            margin-bottom: 32px;
        }

        .section-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--glass-shadow);
        }

        .section-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 24px 32px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
            letter-spacing: -0.02em;
        }

        .header-meta {
            display: flex;
            gap: 24px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .data-count {
            font-weight: 600;
        }

        /* View Switcher */
        .view-switcher {
            position: relative;
        }

        .switcher-track {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            display: flex;
            gap: 4px;
        }

        .switcher-thumb {
            position: absolute;
            top: 4px;
            left: 4px;
            width: calc(50% - 4px);
            height: calc(100% - 8px);
            background: var(--gradient-primary);
            border-radius: 8px;
            transition: var(--transition-smooth);
            z-index: 1;
        }

        .switch-option {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            z-index: 2;
        }

        .switch-option.active {
            color: white;
        }

        /* Stock Grid */
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            padding: 32px;
        }

        .stock-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 24px;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stock-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-status-color);
            transition: height 0.4s ease;
        }

        .stock-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--glass-shadow), 0 0 40px var(--card-status-glow);
            border-color: var(--card-status-color);
        }

        .stock-card:hover::before {
            height: 8px;
        }

        .item-code {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 0.875rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.high {
            background: var(--success-500);
            box-shadow: 0 0 8px var(--success-500);
        }

        .status-dot.medium {
            background: var(--warning-500);
            box-shadow: 0 0 8px var(--warning-500);
        }

        .status-dot.low {
            background: var(--danger-500);
            box-shadow: 0 0 8px var(--danger-500);
            animation: pulse 2s infinite;
        }

        .item-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .item-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .stock-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .metric-value.in {
            color: var(--success-500);
        }

        .metric-value.out {
            color: var(--danger-500);
        }

        .metric-value.current {
            color: var(--text-primary);
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stock-progress {
            margin-top: 16px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: var(--transition-smooth);
            background: var(--progress-gradient);
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Modern Table */
        .modern-table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .modern-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .modern-table th {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            color: var(--text-primary);
            padding: 20px 16px;
            text-align: left;
            font-weight: 700;
            font-size: 0.875rem;
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .th-content {
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modern-table td {
            padding: 20px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
        }

        .modern-table tbody tr {
            transition: var(--transition-smooth);
        }

        .modern-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: scale(1.01);
        }

        /* Modern Empty State */
        .modern-empty {
            padding: 80px 40px;
            text-align: center;
        }

        .empty-animation {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .empty-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-500);
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .empty-circle:nth-child(1) { animation-delay: -0.32s; }
        .empty-circle:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1.0);
            }
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .empty-description {
            color: var(--text-secondary);
            margin-bottom: 32px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-action {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 14px 28px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .empty-action:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--glow-primary);
        }

        /* Report specific styles */
        .report-header {
            background: var(--success-50);
            color: var(--success-800);
            padding: 16px 24px;
            font-weight: 700;
            text-align: center;
            font-size: 1.125rem;
            border-bottom: 1px solid var(--success-200);
        }

        [data-theme="dark"] .report-header {
            background: var(--success-900);
            color: var(--success-200);
            border-bottom-color: var(--success-700);
        }

        .date-range {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .date-range .form-group {
            min-width: 200px;
        }

        /* Report specific enhancements */
        .report-ranking {
            background: linear-gradient(135deg, var(--warning-100), var(--warning-200));
            color: var(--warning-800);
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.875rem;
        }

        [data-theme="dark"] .report-ranking {
            background: linear-gradient(135deg, var(--warning-900), var(--warning-800));
            color: var(--warning-200);
        }

        .report-metric {
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-weight: 600;
            color: var(--primary-600);
        }

        [data-theme="dark"] .report-metric {
            color: var(--primary-400);
        }

        /* Micro-animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .loading {
            animation: spin 1s linear infinite;
        }

        /* Enhanced gradients */
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Enhanced Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stock-card,
        .analytics-card {
            animation: fadeInUp 0.6s ease-out;
        }

        .stock-card:nth-child(1) { animation-delay: 0.1s; }
        .stock-card:nth-child(2) { animation-delay: 0.2s; }
        .stock-card:nth-child(3) { animation-delay: 0.3s; }
        .stock-card:nth-child(4) { animation-delay: 0.4s; }

        /* Analytics Modal Styles */
        .analytics-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 0;
        }

        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .summary-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .analytics-section {
            margin-bottom: 32px;
            padding: 0 24px;
        }

        .analytics-section .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .top-products {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .product-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-500);
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .product-rank {
            width: 32px;
            height: 32px;
            background: var(--primary-500);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .product-details {
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .product-code {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-family: 'SF Mono', monospace;
        }

        .product-stats {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .critical-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .critical-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--danger-50);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--danger-500);
        }

        [data-theme="dark"] .critical-item {
            background: var(--danger-900);
            border-left-color: var(--danger-400);
        }

        .critical-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .critical-icon {
            width: 32px;
            height: 32px;
            background: var(--danger-500);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .critical-details {
            display: flex;
            flex-direction: column;
        }

        .critical-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .critical-status {
            font-size: 0.8rem;
            color: var(--danger-600);
            font-weight: 500;
        }

        .critical-action {
            background: var(--danger-500);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .critical-action:hover {
            background: var(--danger-600);
            transform: translateY(-1px);
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: var(--primary-50);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-500);
        }

        [data-theme="dark"] .insight-item {
            background: var(--primary-900);
            border-left-color: var(--primary-400);
        }

        .insight-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-500);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .insight-content {
            flex: 1;
        }

        .insight-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .insight-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Responsive Design */
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: var(--sidebar-width);
            }
            
            .menu-toggle {
                display: none;
            }
            
            .bottom-nav {
                display: none;
            }
        }

        @media (max-width: 1024px) {
            .bottom-nav {
                display: block;
            }
            
            .sidebar {
                z-index: 1001;
            }

            .interface-glass {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header {
                padding: 0 16px;
            }
            
            .header-title {
                font-size: 1.25rem;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                min-width: auto;
            }

            .table-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .table-header .form-input {
                min-width: auto !important;
                width: 100%;
            }

            .date-range {
                flex-direction: column;
                align-items: stretch;
            }

            .date-range .form-group {
                min-width: auto;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .analytics-card {
                padding: 24px 20px;
            }
            
            .metric-value {
                font-size: 2rem;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .interface-glass,
            .section-glass {
                margin: 0 -16px;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
            
            .section-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
                padding: 24px 16px;
            }
            
            .filter-pills {
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .filter-pills::-webkit-scrollbar {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                padding: 24px;
                margin: 10px;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .stat-icon {
                font-size: 2rem;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-title {
                font-size: 1.75rem;
            }
            
            .analytics-card {
                padding: 20px 16px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            backdrop-filter: blur(4px);
        }

        .overlay.show {
            display: block;
        }

        /* Dark Mode Enhancements */
        [data-theme="dark"] .analytics-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .search-field:focus {
            box-shadow: 0 0 0 3px rgba(54, 110, 255, 0.2);
        }

        [data-theme="dark"] .stock-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">
                 Inventory Pro
            </div>
            <div class="sidebar-subtitle">Modern Stock Management</div>
        </div>
        
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active" onclick="showSection('dashboard', this)">
                <span class="icon"></span> Dashboard
            </a>
            <a href="#" class="menu-item" onclick="showSection('stock-view', this)">
                <span class="icon"></span> Stock View
            </a>
            <a href="#" class="menu-item" onclick="showSection('stock-in', this)">
                <span class="icon"></span> Stock In
            </a>
            <a href="#" class="menu-item" onclick="showSection('stock-out', this)">
                <span class="icon"></span> Stock Out
            </a>
            <a href="#" class="menu-item" onclick="showSection('stock-report', this)">
                <span class="icon"></span> Laporan
            </a>
            <a href="#" class="menu-item" onclick="showSection('items', this)">
                <span class="icon"></span> Items
            </a>
            <a href="#" class="menu-item" onclick="showFonnteSetting()">
                <span class="icon"></span> WhatsApp Settings
            </a>
        </nav>
    </aside>

    <!-- Main Layout -->
    <div class="main-layout" id="mainLayout">
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" onclick="toggleSidebar()"></button>
                    <h1 class="header-title">
                         <span class="gradient-text">Inventory Pro</span>
                    </h1>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle"></button>
                    <div id="firebaseStatus" class="firebase-status"> Disconnected</div>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section active">
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="totalItems">0</div>
                            <div class="stat-label">Total Items</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="totalStockIn">0</div>
                            <div class="stat-label">Stock In Today</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="totalStockOut">0</div>
                            <div class="stat-label">Stock Out Today</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="lowStockItems">0</div>
                            <div class="stat-label">Low Stock Alert</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"> Stock Overview</h2>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-secondary btn-sm" onclick="sendManualStockAlert()">
                                    <span></span> WhatsApp Alert
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Item Name</th>
                                        <th>Unit</th>
                                        <th>Current Stock</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboardTableBody">
                                    <tr>
                                        <td colspan="5">
                                            <div class="empty-state">
                                                <div class="empty-icon"></div>
                                                <div class="empty-text">No items yet. Add some items to get started!</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ultra Modern Stock View Section -->
                <div id="stock-view" class="section">
                    <!-- Modern Hero Section -->
                    <div class="stock-hero">
                        <div class="hero-content">
                            <div class="hero-badge">Manajemen Stok</div>
                            <h1 class="hero-title">Ringkasan Inventory</h1>
                            <p class="hero-subtitle">Monitoring real-time dari level stok dan pergerakan barang Anda</p>
                        </div>
                        
                        <!-- Floating Analytics Cards -->
                        <div class="analytics-grid">
                            <div class="analytics-card primary" data-metric="total">
                                <div class="card-glow"></div>
                                <div class="card-content">
                                    <div class="metric-header">
                                        <span class="metric-label">Total Barang</span>
                                        <div class="metric-trend positive"></div>
                                    </div>
                                    <div class="metric-value" id="stockTotalItems">0</div>
                                    <div class="metric-change">+0 minggu ini</div>
                                </div>
                            </div>
                            
                            <div class="analytics-card success" data-metric="high">
                                <div class="card-glow"></div>
                                <div class="card-content">
                                    <div class="metric-header">
                                        <span class="metric-label">Stok Sehat</span>
                                        <div class="metric-trend positive"></div>
                                    </div>
                                    <div class="metric-value" id="stockHighItems">0</div>
                                    <div class="metric-change">Di atas minimum</div>
                                </div>
                            </div>
                            
                            <div class="analytics-card warning" data-metric="medium">
                                <div class="card-glow"></div>
                                <div class="card-content">
                                    <div class="metric-header">
                                        <span class="metric-label">Perlu Perhatian</span>
                                        <div class="metric-trend neutral"></div>
                                    </div>
                                    <div class="metric-value" id="stockMediumItems">0</div>
                                    <div class="metric-change">Butuh perhatian</div>
                                </div>
                            </div>
                            
                            <div class="analytics-card danger" data-metric="low">
                                <div class="card-glow"></div>
                                <div class="card-content">
                                    <div class="metric-header">
                                        <span class="metric-label">Peringatan Kritis</span>
                                        <div class="metric-trend negative"></div>
                                    </div>
                                    <div class="metric-value" id="stockLowItems">0</div>
                                    <div class="metric-change">Perlu restock urgent</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Control Interface -->
                    <div class="control-interface">
                        <div class="interface-glass">
                            <!-- Smart Search Section -->
                            <div class="search-section">
                                <div class="search-container">
                                    <div class="search-input-group">
                                        <input 
                                            type="text" 
                                            class="search-field" 
                                            id="stockViewSearch" 
                                            placeholder="Cari inventory..." 
                                            oninput="smartSearchStock()"
                                        >
                                        <div class="search-line"></div>
                                        <button class="search-clear" onclick="clearStockSearch()" style="opacity: 0; pointer-events: none;">
                                            <span></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Modern Filter Pills -->
                            <div class="filter-section">
                                <div class="filter-pills">
                                    <button class="filter-pill active" id="filterAll" onclick="filterStockView('all')">
                                        <span class="pill-text">Semua Barang</span>
                                        <span class="pill-badge" id="countAll">0</span>
                                    </button>
                                    <button class="filter-pill success" id="filterHigh" onclick="filterStockView('high')">
                                        <span class="pill-text">Stok Sehat</span>
                                        <span class="pill-badge" id="countHigh">0</span>
                                    </button>
                                    <button class="filter-pill warning" id="filterMedium" onclick="filterStockView('medium')">
                                        <span class="pill-text">Stok Rendah</span>
                                        <span class="pill-badge" id="countMedium">0</span>
                                    </button>
                                    <button class="filter-pill danger" id="filterLow" onclick="filterStockView('low')">
                                        <span class="pill-text">Kritis</span>
                                        <span class="pill-badge" id="countLow">0</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Action Bar -->
                            <div class="action-bar">
                                <button class="action-button primary" onclick="refreshStockView()">
                                    <span class="btn-ripple"></span>
                                    <span class="btn-text">Refresh</span>
                                </button>
                                <button class="action-button secondary" onclick="exportStockData()">
                                    <span class="btn-ripple"></span>
                                    <span class="btn-text">Ekspor</span>
                                </button>
                                <button class="action-button tertiary" onclick="sendManualStockAlert()">
                                    <span class="btn-ripple"></span>
                                    <span class="btn-text"> Alert WA</span>
                                </button>
                                <button class="action-button tertiary" onclick="toggleAdvancedView()">
                                    <span class="btn-ripple"></span>
                                    <span class="btn-text">Analisis</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Visualization Section -->
                    <div class="data-section">
                        <div class="section-glass">
                            <!-- Section Header -->
                            <div class="section-header">
                                <div class="header-main">
                                    <h2 class="section-title">Data Stok</h2>
                                    <div class="header-meta">
                                        <span class="data-count"><span id="displayedItemsCount">0</span> barang ditampilkan</span>
                                        <span class="last-sync">Sinkronisasi terakhir: <span id="lastUpdateTime">--:--</span></span>
                                    </div>
                                </div>
                                
                                <div class="view-switcher">
                                    <div class="switcher-track">
                                        <div class="switcher-thumb" id="switcherThumb"></div>
                                        <button class="switch-option active" onclick="switchView('grid')" id="viewGrid">
                                            <span>Kartu</span>
                                        </button>
                                        <button class="switch-option" onclick="switchView('table')" id="viewTable">
                                            <span>Tabel</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Grid View -->
                            <div class="grid-view" id="gridView">
                                <div class="stock-grid" id="stockGrid">
                                    <!-- Stock cards will be populated here -->
                                </div>
                            </div>

                            <!-- Table View -->
                            <div class="table-view" id="tableViewContainer" style="display: none;">
                                <div class="modern-table-wrapper">
                                    <table class="modern-table">
                                        <thead>
                                            <tr>
                                                <th class="col-status">
                                                    <div class="th-content">Status</div>
                                                </th>
                                                <th class="col-code">
                                                    <div class="th-content">Kode</div>
                                                </th>
                                                <th class="col-name">
                                                    <div class="th-content">Nama Produk</div>
                                                </th>
                                                <th class="col-unit">
                                                    <div class="th-content">Satuan</div>
                                                </th>
                                                <th class="col-stock">
                                                    <div class="th-content">Level Stok</div>
                                                </th>
                                                <th class="col-movement">
                                                    <div class="th-content">Pergerakan</div>
                                                </th>
                                                <th class="col-current">
                                                    <div class="th-content">Saat Ini</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="modernTableBody">
                                            <!-- Table rows will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Modern Empty State -->
                            <div id="modernEmptyState" class="modern-empty" style="display: none;">
                                <div class="empty-animation">
                                    <div class="empty-circle"></div>
                                    <div class="empty-circle"></div>
                                    <div class="empty-circle"></div>
                                </div>
                                <h3 class="empty-title">Tidak ada barang ditemukan</h3>
                                <p class="empty-description">Coba sesuaikan kriteria pencarian atau hapus filter untuk melihat lebih banyak hasil</p>
                                <button class="empty-action" onclick="clearAllFilters()">
                                    <span class="btn-ripple"></span>
                                    <span>Reset Filter</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock In Section - SINGLE FORM ONLY -->
                <div id="stock-in" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"> Add Stock In</h2>
                        </div>
                        <form class="form-grid" onsubmit="addStockIn(event)">
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input" id="stockInDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Item Code</label>
                                <select class="form-select" id="stockInItem" required>
                                    <option value="">Select Item</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Quantity In</label>
                                <input type="number" class="form-input" id="stockInQuantity" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-input" id="stockInNote" placeholder="Purchase, delivery, etc.">
                            </div>
                            <div class="form-group">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-success">
                                    <span></span> Add Stock In
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div class="table-header">
                            <h3 class="table-title"> Stock In History</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Code</th>
                                        <th>Item Name</th>
                                        <th>Quantity</th>
                                        <th>Notes</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="stockInTableBody">
                                    <tr>
                                        <td colspan="6">
                                            <div class="empty-state">
                                                <div class="empty-icon"></div>
                                                <div class="empty-text">No stock in data yet</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Stock Out Section - SINGLE FORM ONLY -->
                <div id="stock-out" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"> Add Stock Out</h2>
                        </div>
                        <form class="form-grid" onsubmit="addStockOut(event)">
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input" id="stockOutDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Item Code</label>
                                <select class="form-select" id="stockOutItem" required>
                                    <option value="">Select Item</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Quantity Out</label>
                                <input type="number" class="form-input" id="stockOutQuantity" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-input" id="stockOutNote" placeholder="Sales, shipment, etc.">
                            </div>
                            <div class="form-group">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-danger">
                                    <span></span> Add Stock Out
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div class="table-header">
                            <h3 class="table-title"> Stock Out History</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Code</th>
                                        <th>Item Name</th>
                                        <th>Quantity</th>
                                        <th>Notes</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="stockOutTableBody">
                                    <tr>
                                        <td colspan="6">
                                            <div class="empty-state">
                                                <div class="empty-icon"></div>
                                                <div class="empty-text">No stock out data yet</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Stock Report Section - SINGLE FORM ONLY -->
                <div id="stock-report" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"> Laporan & Analisis</h2>
                        </div>
                        
                        <div class="date-range">
                            <div class="form-group">
                                <label class="form-label">Tanggal Mulai</label>
                                <input type="date" class="form-input" id="reportStartDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tanggal Selesai</label>
                                <input type="date" class="form-input" id="reportEndDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Jenis Laporan</label>
                                <select class="form-select" id="reportType">
                                    <option value="movement">Pergerakan Stok</option>
                                    <option value="bestseller">Produk Terlaris</option>
                                    <option value="slowmoving">Slow Moving</option>
                                    <option value="stocklevel">Level Stok</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-primary" onclick="generateAdvancedReport()">
                                    <span></span> Buat Laporan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Report Summary Stats -->
                    <div class="stats-grid" id="reportStats" style="display: none;">
                        <div class="stat-card primary">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="reportTotalItems">0</div>
                            <div class="stat-label">Total Produk</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="reportTopSeller">-</div>
                            <div class="stat-label">Produk Terlaris</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="reportSlowItems">0</div>
                            <div class="stat-label">Slow Moving</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="reportLowStock">0</div>
                            <div class="stat-label">Stok Menipis</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="table-container">
                            <div class="report-header" id="reportHeader">
                                 LAPORAN PERGERAKAN STOK
                            </div>
                            <table class="table">
                                <thead id="reportTableHead">
                                    <tr>
                                        <th>Kode</th>
                                        <th>Nama Barang</th>
                                        <th>Satuan</th>
                                        <th>Stok Awal</th>
                                        <th>Barang Masuk</th>
                                        <th>Barang Keluar</th>
                                        <th>Stok Akhir</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody">
                                    <tr>
                                        <td colspan="7">
                                            <div class="empty-state">
                                                <div class="empty-icon"></div>
                                                <div class="empty-text">Pilih jenis laporan, tanggal dan klik Buat Laporan</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Items Master Section - SINGLE FORM ONLY -->
                <div id="items" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"> Master Items</h2>
                        </div>
                        <form class="form-grid" onsubmit="addItem(event)">
                            <div class="form-group">
                                <label class="form-label">Item Code</label>
                                <input type="text" class="form-input" id="itemCode" required placeholder="e.g., ITM001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-input" id="itemName" required placeholder="e.g., Product Name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit</label>
                                <select class="form-select" id="itemUnit" required>
                                    <option value="">Select Unit</option>
                                    <option value="pcs">Pieces</option>
                                    <option value="kg">Kilogram</option>
                                    <option value="liter">Liter</option>
                                    <option value="meter">Meter</option>
                                    <option value="box">Box</option>
                                    <option value="pack">Pack</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Minimum Stock</label>
                                <input type="number" class="form-input" id="itemMinStock" value="10" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-primary">
                                    <span></span> Add Item
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div class="table-header">
                            <h3 class="table-title"> Items List</h3>
                            <div style="display: flex; gap: 16px; align-items: center;">
                                <input type="text" class="form-input" id="searchItems" placeholder=" Cari kode atau nama item..." style="min-width: 250px;" oninput="searchItems()">
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Item Name</th>
                                        <th>Unit</th>
                                        <th>Min. Stock</th>
                                        <th>Current Stock</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    <tr>
                                        <td colspan="7">
                                            <div class="empty-state">
                                                <div class="empty-icon"></div>
                                                <div class="empty-text">No items yet. Add your first item above!</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-items">
            <a href="#" class="bottom-nav-item active" onclick="showSection('dashboard', this)">
                <span class="nav-icon"></span>
                <span class="nav-label">Dashboard</span>
            </a>
            <a href="#" class="bottom-nav-item" onclick="showSection('stock-view', this)">
                <span class="nav-icon"></span>
                <span class="nav-label">View</span>
            </a>
            <a href="#" class="bottom-nav-item" onclick="showSection('stock-in', this)">
                <span class="nav-icon"></span>
                <span class="nav-label">In</span>
            </a>
            <a href="#" class="bottom-nav-item" onclick="showSection('stock-out', this)">
                <span class="nav-icon"></span>
                <span class="nav-label">Out</span>
            </a>
        </div>
    </nav>

    <!-- Analytics Modal -->
    <div class="modal" id="analyticsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title"> Analisis Inventory</h2>
                <button class="modal-close" onclick="closeAnalyticsModal()">&times;</button>
            </div>
            
            <div class="analytics-content">
                <!-- Summary Stats -->
                <div class="analytics-summary">
                    <div class="summary-item">
                        <div class="summary-icon"></div>
                        <div class="summary-data">
                            <div class="summary-value" id="analyticsTotalValue">0</div>
                            <div class="summary-label">Total Item Unik</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon"></div>
                        <div class="summary-data">
                            <div class="summary-value" id="analyticsStockIn">0</div>
                            <div class="summary-label">Total Stok Masuk</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon"></div>
                        <div class="summary-data">
                            <div class="summary-value" id="analyticsStockOut">0</div>
                            <div class="summary-label">Total Stok Keluar</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon"></div>
                        <div class="summary-data">
                            <div class="summary-value" id="analyticsAlerts">0</div>
                            <div class="summary-label">Alert Stok Rendah</div>
                        </div>
                    </div>
                </div>

                <!-- Top Products -->
                <div class="analytics-section">
                    <h3 class="section-title"> Produk Teratas</h3>
                    <div class="top-products" id="topProductsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Critical Items -->
                <div class="analytics-section">
                    <h3 class="section-title"> Item yang Memerlukan Perhatian</h3>
                    <div class="critical-items" id="criticalItemsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Quick Insights -->
                <div class="analytics-section">
                    <h3 class="section-title"> Insights & Rekomendasi</h3>
                    <div class="insights-list" id="insightsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fonnte WhatsApp Settings Modal -->
    <div class="modal" id="fonnteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"> WhatsApp Settings (Fonnte)</h2>
                <button class="modal-close" onclick="closeFonnteModal()">&times;</button>
            </div>
            <form onsubmit="saveFonnteConfig(event)">
                <div class="form-group">
                    <label class="form-label">Fonnte API Token</label>
                    <input type="text" class="form-input" id="fonnteToken" placeholder="Masukkan token dari fonnte.com" required>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">Dapatkan token dari <a href="https://fonnte.com" target="_blank" style="color: var(--primary-500);">fonnte.com</a></small>
                </div>
                <div class="form-group">
                    <label class="form-label">Admin WhatsApp Number</label>
                    <input type="text" class="form-input" id="adminWhatsApp" placeholder="628123456789" required>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">Format: 628xxx tanpa tanda + atau spasi</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Nama Toko/Perusahaan</label>
                    <input type="text" class="form-input" id="companyName" placeholder="CV. Inventory Pro" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Notifikasi Stock Alert</label>
                    <select class="form-select" id="stockAlertEnabled">
                        <option value="true">Aktif</option>
                        <option value="false">Nonaktif</option>
                    </select>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">Kirim pesan WhatsApp saat stok menipis</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Test Connection</label>
                    <button type="button" class="btn btn-secondary" onclick="testFonnteConnection()">
                        <span></span> Test WhatsApp
                    </button>
                </div>
                <div style="display: flex; gap: 16px; margin-top: 32px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <span></span> Simpan Konfigurasi
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeFonnteModal()">
                        Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Global Functions Script -->
    <script>
        // Global variables
        let app, db;
        let items = [];
        let stockMovements = [];
        let currentStockFilter = 'all';
        let currentViewMode = 'card';
        let currentView = 'grid';
        let firebaseConfig = {
            apiKey: "AIzaSyDzQeSBaemkuNwIulwxIzJL5YSVYdsogqU",
            authDomain: "stockflow-inventory.firebaseapp.com",
            projectId: "stockflow-inventory",
            storageBucket: "stockflow-inventory.firebasestorage.app",
            messagingSenderId: "131390386040",
            appId: "1:131390386040:web:3f722b986bc668159da28d"
        };
        
        // Fonnte WhatsApp Configuration
        let fonnteConfig = {
            token: '',
            adminNumber: '',
            companyName: 'Inventory Pro',
            alertEnabled: true
        };
        
        // In-memory storage fallback
        let appStorage = {
            firebaseConfig: firebaseConfig,
            fonnteConfig: fonnteConfig,
            theme: 'light'
        };

        // Initialize window.items and window.stockMovements as arrays
        window.items = [];
        window.stockMovements = [];

        // Safe storage functions
        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                appStorage[key] = value;
                console.log('Using in-memory storage for:', key);
            }
        }

        function getFromStorage(key) {
            try {
                const value = localStorage.getItem(key);
                return value ? JSON.parse(value) : null;
            } catch (error) {
                return appStorage[key] || null;
            }
        }

        // Fonnte WhatsApp Functions
        window.showFonnteSetting = function() {
            document.getElementById('fonnteModu').classList.add('show');
            
            // Load existing config if available
            const savedConfig = getFromStorage('fonnteConfig') || fonnteConfig;
            if (savedConfig) {
                document.getElementById('fonnteToken').value = savedConfig.token || '';
                document.getElementById('adminWhatsApp').value = savedConfig.adminNumber || '';
                document.getElementById('companyName').value = savedConfig.companyName || 'Inventory Pro';
                document.getElementById('stockAlertEnabled').value = savedConfig.alertEnabled ? 'true' : 'false';
            }
        };

        window.closeFonnteModal = function() {
            document.getElementById('fonnteModu').classList.remove('show');
        };

        window.saveFonnteConfig = function(event) {
            event.preventDefault();
            
            const config = {
                token: document.getElementById('fonnteToken').value,
                adminNumber: document.getElementById('adminWhatsApp').value,
                companyName: document.getElementById('companyName').value,
                alertEnabled: document.getElementById('stockAlertEnabled').value === 'true'
            };

            // Validasi nomor WhatsApp
            if (!config.adminNumber.match(/^628[0-9]{9,12}$/)) {
                showNotification(' Format nomor WhatsApp salah! Gunakan format 628xxx', 'error');
                return;
            }

            // Simpan konfigurasi
            fonnteConfig = config;
            saveToStorage('fonnteConfig', config);
            
            showNotification(' Konfigurasi WhatsApp berhasil disimpan!', 'success');
            closeFonnteModal();
        };

        window.testFonnteConnection = function() {
            const token = document.getElementById('fonnteToken').value;
            const adminNumber = document.getElementById('adminWhatsApp').value;
            const companyName = document.getElementById('companyName').value;

            if (!token || !adminNumber) {
                showNotification(' Isi token dan nomor WhatsApp terlebih dahulu!', 'error');
                return;
            }

            const testMessage = ` *Test Connection Berhasil!*\n\nHalo dari ${companyName}!\nSistem inventory WhatsApp notification telah aktif.\n\n Sistem siap mengirim notifikasi stock alert.`;

            sendWhatsAppMessage(adminNumber, testMessage, token)
                .then(() => {
                    showNotification(' Test pesan WhatsApp berhasil dikirim!', 'success');
                })
                .catch(error => {
                    showNotification(' Test gagal: ' + error.message, 'error');
                });
        };

        // Fungsi untuk mengirim WhatsApp melalui Fonnte
        async function sendWhatsAppMessage(target, message, token = null) {
            const config = getFromStorage('fonnteConfig') || fonnteConfig;
            const apiToken = token || config.token;

            if (!apiToken) {
                throw new Error('Token Fonnte belum dikonfigurasi');
            }

            const url = 'https://api.fonnte.com/send';
            const data = {
                target: target,
                message: message,
                countryCode: '62'
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': apiToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (!response.ok || result.status === false) {
                    throw new Error(result.reason || 'Gagal mengirim pesan');
                }

                return result;
            } catch (error) {
                console.error('Error sending WhatsApp:', error);
                throw error;
            }
        }

        // Fungsi untuk check stock dan kirim alert WhatsApp
        function checkStockAlerts() {
            const config = getFromStorage('fonnteConfig') || fonnteConfig;
            
            if (!config.alertEnabled || !config.token || !config.adminNumber) {
                return; // Skip jika tidak dikonfigurasi
            }

            const itemsData = window.items || [];
            const lowStockItems = [];

            itemsData.forEach(item => {
                const currentStock = getCurrentStock(item.code);
                if (currentStock <= item.minStock) {
                    lowStockItems.push({
                        code: item.code,
                        name: item.name,
                        currentStock: currentStock,
                        minStock: item.minStock,
                        needed: Math.max(0, item.minStock * 2 - currentStock)
                    });
                }
            });

            if (lowStockItems.length > 0) {
                sendStockAlert(lowStockItems, config);
            }
        }

        // Kirim notifikasi stock alert
        function sendStockAlert(lowStockItems, config) {
            let message = ` *STOCK ALERT - ${config.companyName}*\n\n`;
            message += `Hai! Ada ${lowStockItems.length} item dengan stok menipis:\n\n`;

            lowStockItems.forEach((item, index) => {
                message += `${index + 1}. *${item.name}* (${item.code})\n`;
                message += `    Stok saat ini: ${item.currentStock}\n`;
                message += `    Minimum: ${item.minStock}\n`;
                message += `    Perlu restock: ${item.needed} unit\n\n`;
            });

            message += ` ${new Date().toLocaleString('id-ID')}\n`;
            message += ` Inventory Management System`;

            sendWhatsAppMessage(config.adminNumber, message)
                .then(() => {
                    console.log('Stock alert sent successfully');
                })
                .catch(error => {
                    console.error('Failed to send stock alert:', error);
                });
        }

        // Auto check stock alerts every 30 minutes
        setInterval(checkStockAlerts, 30 * 60 * 1000);

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Ultra Modern Stock View Functions
        function updateCounterAnimation(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = parseInt(element.textContent) || 0;
            const duration = 1000;
            const startTime = performance.now();
            
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = Math.round(startValue + (targetValue - startValue) * easeOutQuart);
                
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
        }

        window.updateStockSummary = function() {
            try {
                const itemsData = window.items || [];
                let totalItems = itemsData.length;
                let highItems = 0;
                let mediumItems = 0;
                let lowItems = 0;

                itemsData.forEach(item => {
                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    
                    if (status === 'high') highItems++;
                    else if (status === 'medium') mediumItems++;
                    else if (status === 'low') lowItems++;
                });

                // Update analytics cards with animation
                updateCounterAnimation('stockTotalItems', totalItems);
                updateCounterAnimation('stockHighItems', highItems);
                updateCounterAnimation('stockMediumItems', mediumItems);
                updateCounterAnimation('stockLowItems', lowItems);

                // Update filter counts
                document.getElementById('countAll').textContent = totalItems;
                document.getElementById('countHigh').textContent = highItems;
                document.getElementById('countMedium').textContent = mediumItems;
                document.getElementById('countLow').textContent = lowItems;

                // Update last update time
                const now = new Date();
                document.getElementById('lastUpdateTime').textContent = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

            } catch (error) {
                console.error('updateStockSummary error:', error);
            }
        };

        window.clearStockSearch = function() {
            const searchInput = document.getElementById('stockViewSearch');
            const clearBtn = document.querySelector('.search-clear');
            
            if (searchInput) {
                searchInput.value = '';
                if (clearBtn) {
                    clearBtn.style.opacity = '0';
                    clearBtn.style.pointerEvents = 'none';
                }
                updateStockView();
            }
        };

        window.switchView = function(viewType) {
            currentView = viewType;
            const gridView = document.getElementById('gridView');
            const tableView = document.getElementById('tableViewContainer');
            const gridBtn = document.getElementById('viewGrid');
            const tableBtn = document.getElementById('viewTable');
            const thumb = document.getElementById('switcherThumb');

            if (viewType === 'grid') {
                gridView.style.display = 'block';
                tableView.style.display = 'none';
                gridBtn.classList.add('active');
                tableBtn.classList.remove('active');
                thumb.style.transform = 'translateX(0)';
                updateGridView();
            } else {
                gridView.style.display = 'none';
                tableView.style.display = 'block';
                gridBtn.classList.remove('active');
                tableBtn.classList.add('active');
                thumb.style.transform = 'translateX(100%)';
                updateTableView();
            }
        };

        window.updateGridView = function() {
            try {
                const itemsData = window.items || [];
                const searchTerm = document.getElementById('stockViewSearch')?.value.toLowerCase() || '';
                
                let filteredItems = itemsData.filter(item => {
                    const matchesSearch = searchTerm === '' || 
                        (item.code && item.code.toLowerCase().includes(searchTerm)) ||
                        (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                        (item.unit && item.unit.toLowerCase().includes(searchTerm));

                    if (!matchesSearch) return false;

                    if (currentStockFilter === 'all') return true;

                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    return status === currentStockFilter;
                });

                const stockGrid = document.getElementById('stockGrid');
                stockGrid.innerHTML = '';

                filteredItems.forEach((item, index) => {
                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    const stockData = calculateStockMovement(item.code);
                    
                    const statusConfig = {
                        high: { 
                            text: 'Stok Sehat', 
                            color: 'var(--success-500)',
                            glow: 'rgba(16, 185, 129, 0.3)',
                            gradient: 'linear-gradient(135deg, #10b981, #059669)'
                        },
                        medium: { 
                            text: 'Stok Rendah', 
                            color: 'var(--warning-500)',
                            glow: 'rgba(245, 158, 11, 0.3)',
                            gradient: 'linear-gradient(135deg, #f59e0b, #d97706)'
                        },
                        low: { 
                            text: 'Kritis', 
                            color: 'var(--danger-500)',
                            glow: 'rgba(239, 68, 68, 0.3)',
                            gradient: 'linear-gradient(135deg, #ef4444, #dc2626)'
                        }
                    };

                    const config = statusConfig[status] || statusConfig.high;
                    const progressPercentage = Math.min((currentStock / (item.minStock * 3)) * 100, 100);
                    
                    const card = document.createElement('div');
                    card.className = 'stock-card';
                    card.style.setProperty('--card-status-color', config.color);
                    card.style.setProperty('--card-status-glow', config.glow);
                    card.style.setProperty('--progress-gradient', config.gradient);
                    card.style.animationDelay = `${index * 0.1}s`;
                    
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="item-code">${item.code}</div>
                            <div class="status-indicator">
                                <div class="status-dot ${status}"></div>
                                <span>${config.text}</span>
                            </div>
                        </div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-meta">Satuan: ${item.unit}  Min: ${item.minStock}</div>
                        <div class="stock-metrics">
                            <div class="metric">
                                <div class="metric-value in">+${stockData.stockIn}</div>
                                <div class="metric-label">MASUK</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value out">-${stockData.stockOut}</div>
                                <div class="metric-label">KELUAR</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value current">${currentStock}</div>
                                <div class="metric-label">SAAT INI</div>
                            </div>
                        </div>
                        <div class="stock-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%;"></div>
                            </div>
                            <div class="progress-text">
                                <span>Level Stok</span>
                                <span>${Math.round(progressPercentage)}%</span>
                            </div>
                        </div>
                    `;
                    
                    stockGrid.appendChild(card);
                });

                if (filteredItems.length === 0) {
                    stockGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></div>
                            <div style="font-size: 1.25rem; font-weight: 600; margin-bottom: 8px;">Tidak ada barang ditemukan</div>
                            <div>Coba sesuaikan pencarian atau kriteria filter Anda</div>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('updateGridView error:', error);
            }
        };

        window.updateTableView = function() {
            try {
                const itemsData = window.items || [];
                const searchTerm = document.getElementById('stockViewSearch')?.value.toLowerCase() || '';
                
                let filteredItems = itemsData.filter(item => {
                    const matchesSearch = searchTerm === '' || 
                        (item.code && item.code.toLowerCase().includes(searchTerm)) ||
                        (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                        (item.unit && item.unit.toLowerCase().includes(searchTerm));

                    if (!matchesSearch) return false;

                    if (currentStockFilter === 'all') return true;

                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    return status === currentStockFilter;
                });

                const tbody = document.getElementById('modernTableBody');
                tbody.innerHTML = '';

                filteredItems.forEach(item => {
                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    const stockData = calculateStockMovement(item.code);
                    
                    const statusConfig = {
                        high: { text: 'Sehat' },
                        medium: { text: 'Stok Rendah' },
                        low: { text: 'Kritis' }
                    };

                    const config = statusConfig[status] || statusConfig.high;
                    const progressPercentage = Math.min((currentStock / (item.minStock * 3)) * 100, 100);

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="status-dot ${status}"></div>
                                <span style="font-weight: 500;">${config.text}</span>
                            </div>
                        </td>
                        <td>
                            <div class="item-code">${item.code}</div>
                        </td>
                        <td>
                            <div style="font-weight: 600; color: var(--text-primary);">${item.name}</div>
                        </td>
                        <td>
                            <span style="font-weight: 500;">${item.unit}</span>
                        </td>
                        <td>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-secondary);">
                                    <span>Min: ${item.minStock}</span>
                                    <span>${Math.round(progressPercentage)}%</span>
                                </div>
                                <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                    <div style="height: 100%; width: ${progressPercentage}%; background: var(--${status === 'high' ? 'success' : status === 'medium' ? 'warning' : 'danger'}-500); border-radius: 3px; transition: all 0.3s ease;"></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; flex-direction: column; gap: 4px; font-size: 0.85rem;">
                                <div style="color: var(--success-600); font-weight: 600;">+${stockData.stockIn}</div>
                                <div style="color: var(--danger-600); font-weight: 600;">-${stockData.stockOut}</div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--${status === 'high' ? 'success' : status === 'medium' ? 'warning' : 'danger'}-600); text-align: center;">
                                ${currentStock}
                            </div>
                        </td>
                    `;
                });

            } catch (error) {
                console.error('updateTableView error:', error);
            }
        };

        window.clearAllFilters = function() {
            const searchInput = document.getElementById('stockViewSearch');
            if (searchInput) {
                searchInput.value = '';
                window.clearStockSearch();
            }
            
            window.filterStockView('all');
            showNotification(' Filters cleared', 'success');
        };

        window.toggleAdvancedView = function() {
            document.getElementById('analyticsModal').classList.add('show');
            generateAnalytics();
        };

        window.closeAnalyticsModal = function() {
            document.getElementById('analyticsModal').classList.remove('show');
        };

        function generateAnalytics() {
            try {
                const itemsData = window.items || [];
                const movementsData = window.stockMovements || [];
                
                const totalStockIn = movementsData.filter(m => m.type === 'in').reduce((sum, m) => sum + m.quantity, 0);
                const totalStockOut = movementsData.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                const alertCount = itemsData.filter(item => {
                    const currentStock = getCurrentStock(item.code);
                    return currentStock <= item.minStock;
                }).length;

                // Update summary
                document.getElementById('analyticsTotalValue').textContent = itemsData.length;
                document.getElementById('analyticsStockIn').textContent = totalStockIn;
                document.getElementById('analyticsStockOut').textContent = totalStockOut;
                document.getElementById('analyticsAlerts').textContent = alertCount;

                // Generate detailed analytics
                generateTopProducts(itemsData, movementsData);
                generateCriticalItems(itemsData);
                generateInsights(itemsData, movementsData, totalStockIn, totalStockOut, alertCount);

            } catch (error) {
                console.error('generateAnalytics error:', error);
            }
        }

        function generateTopProducts(itemsData, movementsData) {
            try {
                // Calculate stock out for each item (sales)
                const productStats = itemsData.map(item => {
                    const movements = movementsData.filter(m => m.itemCode === item.code);
                    const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                    const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + m.quantity, 0);
                    const currentStock = getCurrentStock(item.code);
                    const turnoverRate = stockIn > 0 ? (stockOut / stockIn * 100) : 0;

                    return {
                        item,
                        stockOut,
                        stockIn,
                        currentStock,
                        turnoverRate: Math.round(turnoverRate)
                    };
                });

                // Sort by stock out (most sold first)
                productStats.sort((a, b) => b.stockOut - a.stockOut);

                // Take top 5
                const topProducts = productStats.slice(0, 5);
                
                const container = document.getElementById('topProductsList');
                container.innerHTML = '';

                if (topProducts.length === 0 || topProducts[0].stockOut === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                            <div>Belum ada data penjualan</div>
                        </div>
                    `;
                    return;
                }

                topProducts.forEach((product, index) => {
                    const productDiv = document.createElement('div');
                    productDiv.className = 'product-item';
                    productDiv.innerHTML = `
                        <div class="product-info">
                            <div class="product-rank">${index + 1}</div>
                            <div class="product-details">
                                <div class="product-name">${product.item.name}</div>
                                <div class="product-code">${product.item.code}</div>
                            </div>
                        </div>
                        <div class="product-stats">
                            <div class="stat-item">
                                <div class="stat-value">${product.stockOut}</div>
                                <div class="stat-label">Terjual</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${product.currentStock}</div>
                                <div class="stat-label">Stok</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${product.turnoverRate}%</div>
                                <div class="stat-label">Turnover</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(productDiv);
                });

            } catch (error) {
                console.error('Error generating top products:', error);
            }
        }

        function generateCriticalItems(itemsData) {
            try {
                const criticalItems = itemsData.filter(item => {
                    const currentStock = getCurrentStock(item.code);
                    return currentStock <= item.minStock;
                });

                const container = document.getElementById('criticalItemsList');
                container.innerHTML = '';

                if (criticalItems.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                            <div>Semua item dalam kondisi stok yang baik!</div>
                        </div>
                    `;
                    return;
                }

                criticalItems.forEach(item => {
                    const currentStock = getCurrentStock(item.code);
                    const needed = Math.max(0, item.minStock * 2 - currentStock);
                    
                    const criticalDiv = document.createElement('div');
                    criticalDiv.className = 'critical-item';
                    criticalDiv.innerHTML = `
                        <div class="critical-info">
                            <div class="critical-icon"></div>
                            <div class="critical-details">
                                <div class="critical-name">${item.name} (${item.code})</div>
                                <div class="critical-status">Stok: ${currentStock} | Min: ${item.minStock} | Perlu: ${needed}</div>
                            </div>
                        </div>
                        <button class="critical-action" onclick="addStockAlert('${item.code}')">
                            Restock
                        </button>
                    `;
                    container.appendChild(criticalDiv);
                });

            } catch (error) {
                console.error('Error generating critical items:', error);
            }
        }

        function generateInsights(itemsData, movementsData, totalStockIn, totalStockOut, alertCount) {
            try {
                const insights = [];
                
                // Insight 1: Stock turnover
                if (totalStockIn > 0) {
                    const turnoverRate = (totalStockOut / totalStockIn * 100).toFixed(1);
                    insights.push({
                        icon: '',
                        title: 'Tingkat Perputaran Stok',
                        description: `Tingkat perputaran stok Anda adalah ${turnoverRate}%. ${turnoverRate > 70 ? 'Perputaran yang sangat baik!' : turnoverRate > 50 ? 'Perputaran yang sehat.' : 'Pertimbangkan strategi untuk meningkatkan penjualan.'}`
                    });
                }

                // Insight 2: Stock alerts
                if (alertCount > 0) {
                    insights.push({
                        icon: '',
                        title: 'Peringatan Stok',
                        description: `Anda memiliki ${alertCount} item dengan stok rendah yang memerlukan perhatian segera. Pertimbangkan untuk melakukan restock untuk menghindari kehabisan stok.`
                    });
                }

                // Insight 3: Inventory health
                const healthyItems = itemsData.filter(item => {
                    const currentStock = getCurrentStock(item.code);
                    return currentStock > item.minStock * 2;
                }).length;

                if (healthyItems > 0) {
                    const healthPercentage = (healthyItems / itemsData.length * 100).toFixed(1);
                    insights.push({
                        icon: '',
                        title: 'Kesehatan Inventory',
                        description: `${healthPercentage}% dari item Anda dalam kondisi stok yang sehat. ${healthPercentage > 80 ? 'Manajemen inventory yang excellent!' : 'Ada ruang untuk perbaikan dalam manajemen stok.'}`
                    });
                }

                // Insight 4: Recent activity
                const recentMovements = movementsData.filter(m => {
                    const moveDate = new Date(m.date);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return moveDate >= weekAgo;
                });

                if (recentMovements.length > 0) {
                    insights.push({
                        icon: '',
                        title: 'Aktivitas Minggu Ini',
                        description: `Ada ${recentMovements.length} transaksi stok dalam 7 hari terakhir. ${recentMovements.length > 10 ? 'Aktivitas inventory yang tinggi!' : 'Aktivitas inventory normal.'}`
                    });
                }

                // Default insight if no data
                if (insights.length === 0) {
                    insights.push({
                        icon: '',
                        title: 'Mulai Tracking',
                        description: 'Tambahkan lebih banyak transaksi stok untuk mendapatkan insight yang lebih mendalam tentang performa inventory Anda.'
                    });
                }

                const container = document.getElementById('insightsList');
                container.innerHTML = '';

                insights.forEach(insight => {
                    const insightDiv = document.createElement('div');
                    insightDiv.className = 'insight-item';
                    insightDiv.innerHTML = `
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-content">
                            <div class="insight-title">${insight.title}</div>
                            <div class="insight-description">${insight.description}</div>
                        </div>
                    `;
                    container.appendChild(insightDiv);
                });

            } catch (error) {
                console.error('Error generating insights:', error);
            }
        }

        window.addStockAlert = function(itemCode) {
            // Switch to stock-in section and pre-fill the item
            showSection('stock-in');
            setTimeout(() => {
                const stockInSelect = document.getElementById('stockInItem');
                if (stockInSelect) {
                    stockInSelect.value = itemCode;
                    const quantityInput = document.getElementById('stockInQuantity');
                    if (quantityInput) {
                        quantityInput.focus();
                    }
                }
                closeAnalyticsModal();
                showNotification(' Navigasi ke Stock In untuk restock item', 'info');
            }, 100);
        };

        window.refreshStockView = function() {
            console.log('refreshStockView called manually');
            
            // Reset filters and search
            currentStockFilter = 'all';
            document.querySelectorAll('.filter-pill').forEach(btn => btn.classList.remove('active'));
            
            const filterAllBtn = document.getElementById('filterAll');
            if (filterAllBtn) {
                filterAllBtn.classList.add('active');
            }
            
            const searchInput = document.getElementById('stockViewSearch');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Update view
            updateStockView();
            showNotification(' Tampilan stok diperbarui!', 'success');
        };

        window.exportStockData = function() {
            if (!window.items || window.items.length === 0) {
                showNotification(' Tidak ada data untuk diekspor!', 'error');
                return;
            }

            // Create CSV content
            let csvContent = "Kode,Nama Barang,Unit,Stok Awal,Barang Masuk,Barang Keluar,Stok Akhir,Status\n";
            
            window.items.forEach(item => {
                const stockData = calculateStockMovement(item.code);
                const status = getStockStatus(item.code, stockData.finalStock);
                const statusText = status === 'high' ? 'Aman' : status === 'medium' ? 'Sedang' : 'Rendah';
                
                csvContent += `"${item.code}","${item.name}","${item.unit}",${stockData.initialStock},${stockData.stockIn},${stockData.stockOut},${stockData.finalStock},"${statusText}"\n`;
            });

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `stock_report_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(' Data berhasil diekspor!', 'success');
        };

        function calculateStockMovement(itemCode) {
            const movements = window.stockMovements?.filter(m => m.itemCode === itemCode) || [];
            
            // For now, calculate all movements (can be extended to date range)
            const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + m.quantity, 0);
            const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
            
            return {
                initialStock: 0, // Can be customized for specific date ranges
                stockIn: stockIn,
                stockOut: stockOut,
                finalStock: stockIn - stockOut
            };
        }

        // Override the original updateStockView
        window.updateStockView = function(searchTerm = '') {
            try {
                updateStockSummary();
                
                const stockViewSection = document.getElementById('stock-view');
                if (!stockViewSection || !stockViewSection.classList.contains('active')) {
                    return;
                }
                
                const itemsData = window.items || [];
                
                if (!Array.isArray(itemsData) || itemsData.length === 0) {
                    showModernEmptyState();
                    return;
                }

                const searchInput = document.getElementById('stockViewSearch');
                const currentSearchTerm = searchTerm || (searchInput ? searchInput.value.toLowerCase() : '');
                
                // Show/hide clear button with animation
                const clearBtn = document.querySelector('.search-clear');
                if (clearBtn) {
                    if (currentSearchTerm) {
                        clearBtn.style.opacity = '1';
                        clearBtn.style.pointerEvents = 'auto';
                    } else {
                        clearBtn.style.opacity = '0';
                        clearBtn.style.pointerEvents = 'none';
                    }
                }

                // Filter items
                let filteredItems = itemsData.filter(item => {
                    const matchesSearch = currentSearchTerm === '' || 
                        (item.code && item.code.toLowerCase().includes(currentSearchTerm)) ||
                        (item.name && item.name.toLowerCase().includes(currentSearchTerm)) ||
                        (item.unit && item.unit.toLowerCase().includes(currentSearchTerm));

                    if (!matchesSearch) return false;

                    if (currentStockFilter === 'all') return true;

                    const currentStock = getCurrentStock(item.code);
                    const status = getStockStatus(item.code, currentStock);
                    return status === currentStockFilter;
                });

                // Update displayed items count
                document.getElementById('displayedItemsCount').textContent = filteredItems.length;

                if (filteredItems.length === 0) {
                    showModernEmptyState();
                    return;
                }

                hideModernEmptyState();
                
                if (currentView === 'grid') {
                    updateGridView();
                } else {
                    updateTableView();
                }

            } catch (error) {
                console.error('updateStockView error:', error);
            }
        };

        function showModernEmptyState() {
            document.getElementById('gridView').style.display = 'none';
            document.getElementById('tableViewContainer').style.display = 'none';
            document.getElementById('modernEmptyState').style.display = 'block';
        }

        function hideModernEmptyState() {
            document.getElementById('modernEmptyState').style.display = 'none';
            
            if (currentView === 'grid') {
                document.getElementById('gridView').style.display = 'block';
            } else {
                document.getElementById('tableViewContainer').style.display = 'block';
            }
        }

        // Override filter function
        window.filterStockView = function(filterType) {
            currentStockFilter = filterType;
            
            document.querySelectorAll('.filter-pill').forEach(btn => btn.classList.remove('active'));
            
            let activeButtonId;
            switch(filterType) {
                case 'all': activeButtonId = 'filterAll'; break;
                case 'high': activeButtonId = 'filterHigh'; break;
                case 'medium': activeButtonId = 'filterMedium'; break;
                case 'low': activeButtonId = 'filterLow'; break;
            }
            
            const activeBtn = document.getElementById(activeButtonId);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            const searchInput = document.getElementById('stockViewSearch');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            updateStockView(searchTerm);
        };

        // Enhanced search function
        window.smartSearchStock = function() {
            const searchInput = document.getElementById('stockViewSearch');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            
            const clearBtn = document.querySelector('.search-clear');
            if (clearBtn) {
                if (searchTerm) {
                    clearBtn.style.opacity = '1';
                    clearBtn.style.pointerEvents = 'auto';
                } else {
                    clearBtn.style.opacity = '0';
                    clearBtn.style.pointerEvents = 'none';
                }
            }
            
            updateStockView(searchTerm);
        };

        // Manual Stock Alert - bisa dipanggil dari tombol
        window.sendManualStockAlert = function() {
            const config = getFromStorage('fonnteConfig') || fonnteConfig;
            
            if (!config.token || !config.adminNumber) {
                showNotification(' Konfigurasi WhatsApp belum lengkap!', 'error');
                window.showFonnteSetting();
                return;
            }

            checkStockAlerts();
            showNotification(' Mengecek stock dan mengirim alert WhatsApp...', 'info');
        };

        // Search items function
        window.searchItems = function() {
            try {
                const searchInput = document.getElementById('searchItems');
                const tbody = document.getElementById('itemsTableBody');
                
                if (!searchInput || !tbody) return;
                
                const searchTerm = searchInput.value.toLowerCase();
                
                // Use global items data or window.items
                const itemsData = window.items || items || [];
                const stockData = window.stockMovements || stockMovements || [];
                
                // Check if items data exists
                if (itemsData.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <div class="empty-icon"></div>
                                    <div class="empty-text">No items yet. Add your first item above!</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Filter items based on search term
                let filteredItems = itemsData;
                if (searchTerm.trim() !== '') {
                    filteredItems = itemsData.filter(item => 
                        (item.code && item.code.toLowerCase().includes(searchTerm)) || 
                        (item.name && item.name.toLowerCase().includes(searchTerm))
                    );
                }

                // Clear current table
                tbody.innerHTML = '';

                // Show no results message if filtered items is empty
                if (filteredItems.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <div class="empty-icon"></div>
                                    <div class="empty-text">Tidak ditemukan item dengan kata kunci "${searchInput.value}"</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Function to calculate current stock
                function getItemStock(itemCode) {
                    if (stockData.length === 0) return 0;
                    const movements = stockData.filter(m => m.itemCode === itemCode);
                    const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + (m.quantity || 0), 0);
                    const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + (m.quantity || 0), 0);
                    return stockIn - stockOut;
                }

                // Populate table with filtered items
                filteredItems.forEach(item => {
                    const currentStock = getItemStock(item.code);
                    const minStock = item.minStock || 0;
                    
                    let status = 'high';
                    if (currentStock <= minStock) status = 'low';
                    else if (currentStock <= minStock * 2) status = 'medium';
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td><strong>${item.code || ''}</strong></td>
                        <td>${item.name || ''}</td>
                        <td>${item.unit || ''}</td>
                        <td>${minStock}</td>
                        <td><strong>${currentStock}</strong></td>
                        <td><span class="stock-badge stock-${status}">${status === 'high' ? ' Good' : status === 'medium' ? ' OK' : ' Low'}</span></td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id || ''}')"></button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('searchItems error:', error);
            }
        };

        // Generate Advanced Report Function
        window.generateAdvancedReport = function() {
            try {
                const startDate = document.getElementById('reportStartDate').value;
                const endDate = document.getElementById('reportEndDate').value;
                const reportType = document.getElementById('reportType').value;

                if (!startDate || !endDate) {
                    showNotification(' Pilih tanggal mulai dan selesai!', 'error');
                    return;
                }

                const itemsData = window.items || [];
                const movementsData = window.stockMovements || [];
                
                // Show stats
                document.getElementById('reportStats').style.display = 'grid';
                
                // Filter movements by date range
                const filteredMovements = movementsData.filter(m => {
                    const moveDate = new Date(m.date);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    return moveDate >= start && moveDate <= end;
                });

                const tbody = document.getElementById('reportTableBody');
                const header = document.getElementById('reportHeader');
                const tableHead = document.getElementById('reportTableHead');
                
                tbody.innerHTML = '';

                switch(reportType) {
                    case 'movement':
                        generateMovementReport(itemsData, filteredMovements, tbody, header, tableHead);
                        break;
                    case 'bestseller':
                        generateBestsellerReport(itemsData, filteredMovements, tbody, header, tableHead);
                        break;
                    case 'slowmoving':
                        generateSlowMovingReport(itemsData, filteredMovements, tbody, header, tableHead);
                        break;
                    case 'stocklevel':
                        generateStockLevelReport(itemsData, tbody, header, tableHead);
                        break;
                }

                // Update stats
                updateReportStats(itemsData, filteredMovements, reportType);
                
                showNotification(' Laporan berhasil dibuat!', 'success');

            } catch (error) {
                console.error('generateAdvancedReport error:', error);
                showNotification(' Error generating report!', 'error');
            }
        };

        function generateMovementReport(itemsData, movementsData, tbody, header, tableHead) {
            header.textContent = ' LAPORAN PERGERAKAN STOK';
            tableHead.innerHTML = `
                <tr>
                    <th>Kode</th>
                    <th>Nama Barang</th>
                    <th>Satuan</th>
                    <th>Stok Awal</th>
                    <th>Barang Masuk</th>
                    <th>Barang Keluar</th>
                    <th>Stok Akhir</th>
                </tr>
            `;

            itemsData.forEach(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + m.quantity, 0);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                const finalStock = getCurrentStock(item.code);
                const initialStock = finalStock - stockIn + stockOut;

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td>${item.unit}</td>
                    <td class="report-metric">${initialStock}</td>
                    <td class="report-metric" style="color: var(--success-600);">+${stockIn}</td>
                    <td class="report-metric" style="color: var(--danger-600);">-${stockOut}</td>
                    <td class="report-metric"><strong>${finalStock}</strong></td>
                `;
            });
        }

        function generateBestsellerReport(itemsData, movementsData, tbody, header, tableHead) {
            header.textContent = ' LAPORAN PRODUK TERLARIS';
            tableHead.innerHTML = `
                <tr>
                    <th>Ranking</th>
                    <th>Kode</th>
                    <th>Nama Barang</th>
                    <th>Total Keluar</th>
                    <th>Turnover Rate</th>
                    <th>Stok Tersisa</th>
                </tr>
            `;

            const productStats = itemsData.map(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + m.quantity, 0);
                const turnoverRate = stockIn > 0 ? (stockOut / stockIn * 100).toFixed(1) : 0;

                return {
                    item,
                    stockOut,
                    turnoverRate,
                    currentStock: getCurrentStock(item.code)
                };
            });

            productStats.sort((a, b) => b.stockOut - a.stockOut);

            productStats.forEach((product, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><span class="report-ranking">#${index + 1}</span></td>
                    <td><strong>${product.item.code}</strong></td>
                    <td>${product.item.name}</td>
                    <td class="report-metric" style="color: var(--danger-600);">${product.stockOut}</td>
                    <td class="report-metric">${product.turnoverRate}%</td>
                    <td class="report-metric">${product.currentStock}</td>
                `;
            });
        }

        function generateSlowMovingReport(itemsData, movementsData, tbody, header, tableHead) {
            header.textContent = ' LAPORAN SLOW MOVING ITEMS';
            tableHead.innerHTML = `
                <tr>
                    <th>Kode</th>
                    <th>Nama Barang</th>
                    <th>Stok Saat Ini</th>
                    <th>Total Keluar</th>
                    <th>Last Movement</th>
                    <th>Status</th>
                </tr>
            `;

            const slowMovingItems = itemsData.filter(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                return stockOut <= 5; // Items with very low movement
            });

            slowMovingItems.forEach(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                const lastMovement = movements.length > 0 ? 
                    new Date(Math.max(...movements.map(m => new Date(m.date)))).toLocaleDateString() : 
                    'No Data';

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td class="report-metric">${getCurrentStock(item.code)}</td>
                    <td class="report-metric">${stockOut}</td>
                    <td>${lastMovement}</td>
                    <td><span class="stock-badge stock-medium"> Slow</span></td>
                `;
            });

            if (slowMovingItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-icon"></div>
                                <div class="empty-text">Tidak ada slow moving items dalam periode ini</div>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        function generateStockLevelReport(itemsData, tbody, header, tableHead) {
            header.textContent = ' LAPORAN LEVEL STOK';
            tableHead.innerHTML = `
                <tr>
                    <th>Kode</th>
                    <th>Nama Barang</th>
                    <th>Stok Minimum</th>
                    <th>Stok Saat Ini</th>
                    <th>Status</th>
                    <th>Rekomendasi</th>
                </tr>
            `;

            itemsData.forEach(item => {
                const currentStock = getCurrentStock(item.code);
                const status = getStockStatus(item.code, currentStock);
                const needed = Math.max(0, (item.minStock * 2) - currentStock);
                
                let recommendation = 'Stok Aman';
                if (status === 'low') recommendation = `Restock ${needed} unit`;
                else if (status === 'medium') recommendation = 'Monitor Ketat';

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td class="report-metric">${item.minStock}</td>
                    <td class="report-metric">${currentStock}</td>
                    <td><span class="stock-badge stock-${status}">${status === 'high' ? ' Aman' : status === 'medium' ? ' Sedang' : ' Rendah'}</span></td>
                    <td>${recommendation}</td>
                `;
            });
        }

        function updateReportStats(itemsData, movementsData, reportType) {
            document.getElementById('reportTotalItems').textContent = itemsData.length;
            
            // Find top seller
            const productStats = itemsData.map(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                return { item, stockOut };
            });
            
            productStats.sort((a, b) => b.stockOut - a.stockOut);
            const topSeller = productStats[0];
            document.getElementById('reportTopSeller').textContent = topSeller ? topSeller.item.name : '-';
            
            // Count slow moving items
            const slowItems = itemsData.filter(item => {
                const movements = movementsData.filter(m => m.itemCode === item.code);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + m.quantity, 0);
                return stockOut <= 5;
            }).length;
            document.getElementById('reportSlowItems').textContent = slowItems;
            
            // Count low stock items
            const lowStockItems = itemsData.filter(item => {
                const currentStock = getCurrentStock(item.code);
                return currentStock <= item.minStock;
            }).length;
            document.getElementById('reportLowStock').textContent = lowStockItems;
        }
    </script>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, query, orderBy, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Initialize Firebase
        function initializeFirebase(config) {
            try {
                app = initializeApp(config);
                db = getFirestore(app);
                
                // Save config using safe storage
                saveToStorage('firebaseConfig', config);
                
                // Update status
                updateFirebaseStatus(true);
                
                // Setup listeners
                setupFirebaseListeners();
                
                // Load initial data
                loadItems();
                loadStockMovements();
                
                showNotification(' Firebase connected successfully!', 'success');
            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateFirebaseStatus(false);
                showNotification(' Error connecting to Firebase!', 'error');
            }
        }

        // Setup Firebase real-time listeners
        function setupFirebaseListeners() {
            if (!db) return;

            // Listen to items
            onSnapshot(collection(db, 'items'), (snapshot) => {
                items = [];
                snapshot.forEach((doc) => {
                    items.push({ id: doc.id, ...doc.data() });
                });
                // Make items globally accessible
                window.items = items;
                console.log('Items updated from Firebase:', items);
                
                updateItemsTable();
                updateDropdowns();
                updateDashboard();
                refreshStockViewData();
            });

            // Listen to stock movements
            onSnapshot(collection(db, 'stockMovements'), (snapshot) => {
                stockMovements = [];
                snapshot.forEach((doc) => {
                    stockMovements.push({ id: doc.id, ...doc.data() });
                });
                // Make stockMovements globally accessible
                window.stockMovements = stockMovements;
                console.log('Stock movements updated from Firebase:', stockMovements);
                
                updateStockTables();
                updateDashboard();
                refreshStockViewData();
            });
        }

        // Update Firebase connection status
        function updateFirebaseStatus(connected) {
            const statusEl = document.getElementById('firebaseStatus');
            if (connected) {
                statusEl.innerHTML = ' Connected';
                statusEl.classList.add('connected');
                statusEl.style.color = 'var(--success-700)';
            } else {
                statusEl.innerHTML = ' Disconnected';
                statusEl.classList.remove('connected');
                statusEl.style.color = 'var(--danger-700)';
            }
        }

        // Load items from Firebase
        async function loadItems() {
            if (!db) return;
            try {
                const querySnapshot = await getDocs(collection(db, 'items'));
                items = [];
                querySnapshot.forEach((doc) => {
                    items.push({ id: doc.id, ...doc.data() });
                });
                // Make items globally accessible
                window.items = items;
                console.log('Items loaded from Firebase:', items);
                
                updateItemsTable();
                updateDropdowns();
                updateDashboard();
                refreshStockViewData();
            } catch (error) {
                console.error('Error loading items:', error);
                showNotification('Error loading items', 'error');
            }
        }

        // Load stock movements from Firebase
        async function loadStockMovements() {
            if (!db) return;
            try {
                const querySnapshot = await getDocs(query(collection(db, 'stockMovements'), orderBy('date', 'desc')));
                stockMovements = [];
                querySnapshot.forEach((doc) => {
                    stockMovements.push({ id: doc.id, ...doc.data() });
                });
                // Make stockMovements globally accessible
                window.stockMovements = stockMovements;
                console.log('Stock movements loaded from Firebase:', stockMovements);
                
                updateStockTables();
                updateDashboard();
                refreshStockViewData();
            } catch (error) {
                console.error('Error loading stock movements:', error);
                showNotification('Error loading stock movements', 'error');
            }
        }

        // Add item
        window.addItem = async function(event) {
            event.preventDefault();
            if (!db) {
                showNotification(' Firebase not connected!', 'error');
                return;
            }

            const code = document.getElementById('itemCode').value;
            const name = document.getElementById('itemName').value;
            const unit = document.getElementById('itemUnit').value;
            const minStock = parseInt(document.getElementById('itemMinStock').value);

            // Check if code already exists
            if (items.some(item => item.code === code)) {
                showNotification(' Item code already exists!', 'error');
                return;
            }

            try {
                await addDoc(collection(db, 'items'), {
                    code,
                    name,
                    unit,
                    minStock,
                    currentStock: 0,
                    timestamp: new Date()
                });

                // Reset form
                document.getElementById('itemCode').value = '';
                document.getElementById('itemName').value = '';
                document.getElementById('itemUnit').value = '';
                document.getElementById('itemMinStock').value = '10';

                showNotification(' Item added successfully!', 'success');
            } catch (error) {
                console.error('Error adding item:', error);
                showNotification(' Error adding item!', 'error');
            }
        };

        // Add stock in
        window.addStockIn = async function(event) {
            event.preventDefault();
            if (!db) {
                showNotification(' Firebase not connected!', 'error');
                return;
            }

            const date = document.getElementById('stockInDate').value;
            const itemCode = document.getElementById('stockInItem').value;
            const quantity = parseInt(document.getElementById('stockInQuantity').value);
            const note = document.getElementById('stockInNote').value;

            if (!itemCode) {
                showNotification(' Please select an item!', 'error');
                return;
            }

            try {
                const item = items.find(i => i.code === itemCode);
                
                await addDoc(collection(db, 'stockMovements'), {
                    date,
                    itemCode,
                    itemName: item.name,
                    type: 'in',
                    quantity,
                    note: note || 'Stock in',
                    timestamp: new Date()
                });

                // Reset form
                document.getElementById('stockInDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('stockInItem').value = '';
                document.getElementById('stockInQuantity').value = '';
                document.getElementById('stockInNote').value = '';

                showNotification(' Stock in recorded successfully!', 'success');
            } catch (error) {
                console.error('Error adding stock in:', error);
                showNotification(' Error recording stock in!', 'error');
            }
        };

        // Add stock out
        window.addStockOut = async function(event) {
            event.preventDefault();
            if (!db) {
                showNotification(' Firebase not connected!', 'error');
                return;
            }

            const date = document.getElementById('stockOutDate').value;
            const itemCode = document.getElementById('stockOutItem').value;
            const quantity = parseInt(document.getElementById('stockOutQuantity').value);
            const note = document.getElementById('stockOutNote').value;

            if (!itemCode) {
                showNotification(' Please select an item!', 'error');
                return;
            }

            const currentStock = getCurrentStock(itemCode);
            if (quantity > currentStock) {
                showNotification(` Insufficient stock! Current stock: ${currentStock}`, 'error');
                return;
            }

            try {
                const item = items.find(i => i.code === itemCode);
                
                await addDoc(collection(db, 'stockMovements'), {
                    date,
                    itemCode,
                    itemName: item.name,
                    type: 'out',
                    quantity,
                    note: note || 'Stock out',
                    timestamp: new Date()
                });

                // Reset form
                document.getElementById('stockOutDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('stockOutItem').value = '';
                document.getElementById('stockOutQuantity').value = '';
                document.getElementById('stockOutNote').value = '';

                showNotification(' Stock out recorded successfully!', 'success');
            } catch (error) {
                console.error('Error adding stock out:', error);
                showNotification(' Error recording stock out!', 'error');
            }
        };

        // Delete item
        window.deleteItem = async function(itemId) {
            if (!db) return;
            
            if (!confirm('Are you sure you want to delete this item?')) return;

            try {
                await deleteDoc(doc(db, 'items', itemId));
                showNotification(' Item deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting item:', error);
                showNotification(' Error deleting item!', 'error');
            }
        };

        // Delete stock movement
        window.deleteStockMovement = async function(movementId) {
            if (!db) return;
            
            if (!confirm('Are you sure you want to delete this record?')) return;

            try {
                await deleteDoc(doc(db, 'stockMovements', movementId));
                showNotification(' Record deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting stock movement:', error);
                showNotification(' Error deleting record!', 'error');
            }
        };

        // Get current stock for an item
        function getCurrentStock(itemCode) {
            try {
                const movements = (window.stockMovements || stockMovements || []).filter(m => m.itemCode === itemCode);
                const stockIn = movements.filter(m => m.type === 'in').reduce((sum, m) => sum + (m.quantity || 0), 0);
                const stockOut = movements.filter(m => m.type === 'out').reduce((sum, m) => sum + (m.quantity || 0), 0);
                return stockIn - stockOut;
            } catch (error) {
                console.warn('getCurrentStock error:', error);
                return 0;
            }
        }

        // Make getCurrentStock globally accessible
        window.getCurrentStock = getCurrentStock;

        // Get stock status
        function getStockStatus(itemCode, currentStock) {
            try {
                const itemsArray = window.items || items || [];
                const item = itemsArray.find(i => i.code === itemCode);
                if (!item) return 'unknown';

                const stock = currentStock !== undefined ? currentStock : getCurrentStock(itemCode);
                const minStock = item.minStock || 0;

                if (stock <= minStock) return 'low';
                if (stock <= minStock * 2) return 'medium';
                return 'high';
            } catch (error) {
                console.warn('getStockStatus error:', error);
                return 'unknown';
            }
        }

        // Make getStockStatus globally accessible
        window.getStockStatus = getStockStatus;

        // Update Stock View when data changes
        function refreshStockViewData() {
            try {
                console.log('refreshStockViewData called');
                const stockViewSection = document.getElementById('stock-view');
                if (stockViewSection && stockViewSection.classList.contains('active')) {
                    console.log('Stock View is active, refreshing data...');
                    const searchInput = document.getElementById('stockViewSearch');
                    const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                    
                    console.log('Current search term:', searchTerm);
                    console.log('Available items:', window.items);
                    
                    updateStockView(searchTerm);
                } else {
                    console.log('Stock View not active, skipping refresh');
                }
            } catch (error) {
                console.error('refreshStockViewData error:', error);
            }
        }

        // Update items table
        function updateItemsTable() {
            // Check if search is active
            const searchInput = document.getElementById('searchItems');
            const hasSearchTerm = searchInput && searchInput.value.trim() !== '';
            
            // If search is active, use search function instead
            if (hasSearchTerm) {
                window.searchItems();
                return;
            }
            
            const tbody = document.getElementById('itemsTableBody');
            tbody.innerHTML = '';

            if (items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-icon"></div>
                                <div class="empty-text">No items yet. Add your first item above!</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            items.forEach(item => {
                const currentStock = getCurrentStock(item.code);
                const status = getStockStatus(item.code, currentStock);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td>${item.unit}</td>
                    <td>${item.minStock}</td>
                    <td><strong>${currentStock}</strong></td>
                    <td><span class="stock-badge stock-${status}">${status === 'high' ? ' Good' : status === 'medium' ? ' OK' : ' Low'}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"></button>
                    </td>
                `;
            });
        }

        // Update dropdowns
        function updateDropdowns() {
            const stockInSelect = document.getElementById('stockInItem');
            const stockOutSelect = document.getElementById('stockOutItem');
            
            // Clear existing options
            stockInSelect.innerHTML = '<option value="">Select Item</option>';
            stockOutSelect.innerHTML = '<option value="">Select Item</option>';
            
            items.forEach(item => {
                const option1 = document.createElement('option');
                option1.value = item.code;
                option1.textContent = `${item.code} - ${item.name}`;
                stockInSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = item.code;
                option2.textContent = `${item.code} - ${item.name}`;
                stockOutSelect.appendChild(option2);
            });
        }

        // Update stock tables
        function updateStockTables() {
            updateStockInTable();
            updateStockOutTable();
        }

        // Update stock in table
        function updateStockInTable() {
            const tbody = document.getElementById('stockInTableBody');
            tbody.innerHTML = '';

            const stockInMovements = stockMovements.filter(m => m.type === 'in');

            if (stockInMovements.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-icon"></div>
                                <div class="empty-text">No stock in data yet</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            stockInMovements.forEach(movement => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(movement.date).toLocaleDateString('en-US')}</td>
                    <td><strong>${movement.itemCode}</strong></td>
                    <td>${movement.itemName}</td>
                    <td><span style="color: var(--success-500); font-weight: 600;">+${movement.quantity}</span></td>
                    <td>${movement.note}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteStockMovement('${movement.id}')"></button>
                    </td>
                `;
            });
        }

        // Update stock out table
        function updateStockOutTable() {
            const tbody = document.getElementById('stockOutTableBody');
            tbody.innerHTML = '';

            const stockOutMovements = stockMovements.filter(m => m.type === 'out');

            if (stockOutMovements.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-icon"></div>
                                <div class="empty-text">No stock out data yet</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            stockOutMovements.forEach(movement => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(movement.date).toLocaleDateString('en-US')}</td>
                    <td><strong>${movement.itemCode}</strong></td>
                    <td>${movement.itemName}</td>
                    <td><span style="color: var(--danger-500); font-weight: 600;">-${movement.quantity}</span></td>
                    <td>${movement.note}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteStockMovement('${movement.id}')"></button>
                    </td>
                `;
            });
        }

        // Update dashboard
        function updateDashboard() {
            // Update stats
            document.getElementById('totalItems').textContent = items.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayStockIn = stockMovements.filter(m => m.type === 'in' && m.date === today).reduce((sum, m) => sum + m.quantity, 0);
            const todayStockOut = stockMovements.filter(m => m.type === 'out' && m.date === today).reduce((sum, m) => sum + m.quantity, 0);
            
            document.getElementById('totalStockIn').textContent = todayStockIn;
            document.getElementById('totalStockOut').textContent = todayStockOut;

            // Count low stock items
            let lowStockCount = 0;
            items.forEach(item => {
                const currentStock = getCurrentStock(item.code);
                if (currentStock <= item.minStock) {
                    lowStockCount++;
                }
            });
            document.getElementById('lowStockItems').textContent = lowStockCount;

            // Check for stock alerts and send WhatsApp if needed
            if (lowStockCount > 0) {
                // Delay to avoid spam, only check every hour
                const lastAlertCheck = getFromStorage('lastStockAlertCheck');
                const now = Date.now();
                const oneHour = 60 * 60 * 1000;
                
                if (!lastAlertCheck || (now - lastAlertCheck) > oneHour) {
                    setTimeout(() => {
                        checkStockAlerts();
                        saveToStorage('lastStockAlertCheck', now);
                    }, 2000); // Delay 2 detik
                }
            }

            // Update dashboard table
            const tbody = document.getElementById('dashboardTableBody');
            tbody.innerHTML = '';

            if (items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <div class="empty-icon"></div>
                                <div class="empty-text">No items yet. Add some items to get started!</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            items.slice(0, 10).forEach(item => {
                const currentStock = getCurrentStock(item.code);
                const status = getStockStatus(item.code, currentStock);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td>${item.unit}</td>
                    <td><strong>${currentStock}</strong></td>
                    <td><span class="stock-badge stock-${status}">${status === 'high' ? ' Good' : status === 'medium' ? ' OK' : ' Low'}</span></td>
                `;
            });
        }

        window.saveFirebaseConfig = function(event) {
            // Function removed - Firebase config is now hardcoded for stability
        };

        // Initialize on page load
        window.addEventListener('load', function() {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const firstDay = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
            
            document.getElementById('stockInDate').value = today;
            document.getElementById('stockOutDate').value = today;
            document.getElementById('reportStartDate').value = firstDay;
            document.getElementById('reportEndDate').value = today;

            // Initialize Firebase with default config
            initializeFirebase(firebaseConfig);

            // Load theme
            const savedTheme = getFromStorage('theme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();

            // Load Fonnte config
            const savedFonnteConfig = getFromStorage('fonnteConfig');
            if (savedFonnteConfig) {
                fonnteConfig = savedFonnteConfig;
            }

            // Initialize Stock View filters
            setTimeout(() => {
                try {
                    const filterAllBtn = document.getElementById('filterAll');
                    if (filterAllBtn) {
                        filterAllBtn.classList.add('active');
                    }
                } catch (error) {
                    console.warn('Filter initialization error:', error);
                }
            }, 300);

            console.log(' Inventory Pro loaded with WhatsApp integration!');
        });

        // Make functions globally accessible
        try {
            window.updateItemsTable = updateItemsTable;
            window.updateStockView = window.updateStockView;
            window.refreshStockViewData = refreshStockViewData;
            
        } catch (error) {
            console.warn('Global function assignment error:', error);
        }
    </script>

    <!-- UI Control Scripts -->
    <script>
        // Global variables for UI
        let currentTheme = 'light';

        // Navigation functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (window.innerWidth >= 1024) return;
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
        }

        function showSection(sectionId, element) {
            try {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Update sidebar menu
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Update bottom nav
                document.querySelectorAll('.bottom-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (element) {
                    element.classList.add('active');
                }

                // Initialize Stock View if needed
                if (sectionId === 'stock-view') {
                    setTimeout(() => {
                        try {
                            currentStockFilter = 'all';
                            document.querySelectorAll('.filter-pill').forEach(btn => btn.classList.remove('active'));
                            
                            const filterAllBtn = document.getElementById('filterAll');
                            if (filterAllBtn) {
                                filterAllBtn.classList.add('active');
                            }
                            
                            const searchInput = document.getElementById('stockViewSearch');
                            if (searchInput) {
                                searchInput.value = '';
                            }
                            
                            updateStockSummary();
                            updateStockView();
                            switchView('grid');
                        } catch (error) {
                            console.error('Stock view initialization error:', error);
                        }
                    }, 200);
                }
                
                // Close sidebar on mobile
                if (window.innerWidth < 1024) {
                    closeSidebar();
                }
            } catch (error) {
                console.error('showSection error:', error);
            }
        }

        // Theme functions
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            saveToStorage('theme', currentTheme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.textContent = currentTheme === 'light' ? '' : '';
        }

        // Handle responsive behavior
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                closeSidebar();
                document.querySelector('.bottom-nav').style.display = 'none';
            } else {
                document.querySelector('.bottom-nav').style.display = 'block';
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            // Fonnte modal
            const fonnteModal = document.getElementById('fonnteModu');
            if (fonnteModal && fonnteModal.classList.contains('show') && event.target === fonnteModal) {
                window.closeFonnteModal();
            }
            
            // Analytics modal
            const analyticsModal = document.getElementById('analyticsModal');
            if (analyticsModal && analyticsModal.classList.contains('show') && event.target === analyticsModal) {
                window.closeAnalyticsModal();
            }
            
            // Sidebar mobile behavior
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth < 1024 && 
                sidebar && menuToggle &&
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target) &&
                sidebar.classList.contains('open')) {
                closeSidebar();
            }
        });

        // Initialize theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = getFromStorage('theme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
        });

        console.log(' Inventory Pro - Sistema Modern loaded successfully!');
    </script>
</body>
</html>